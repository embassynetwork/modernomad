language: python
python:
  - "3.6"
sudo: false
cache:
  pip: true
  directories:
    - node_modules
services:
  - postgresql
env:
  - DJANGO_SETTINGS_MODULE=modernomad.settings.local
    DATABASE_URL=postgres://postgres@localhost/test_db
install:
  - "pip install -U pip wheel"
  - "nvm install 8"
  - "pip install -r requirements.txt"
before_script:
  - psql -c 'create database test_db;' -U postgres
  - "cd client && npm install && cd .."
  - "cd client && ./node_modules/.bin/webpack --config webpack.prod.config.js && cd .."
script: ./manage.py test
notifications:
  slack:
    rooms:
      - embassy-network:joFu5a311yAWnrF7DQGKtl02#modernomad-notify
  email:
    recipients:
      - craig@enspiral.com
    on_success: change
    on_failure: always
